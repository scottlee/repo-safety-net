#!/bin/sh

#########################################
# Grab the repo status from an endpoint.
# Allow the commit if the repo is open.
# Abort the commit it's closed.
# @todo Rework below to only hit the server once by parsing results.
#########################################

## API Endpoint
endpoint_url="http://example.com/repo-status/"

## Grab current branch.
## If it's not master, exit.
current_branch=$(git symbolic-ref HEAD 2>/dev/null)

if [[ 'refs/heads/master' != "$current_branch" ]]; then
	exit 0
fi

echo "Getting status of production repo..."

## Grab the header response
response_header=$(curl -s -o /dev/null -w "%{http_code}" "$endpoint_url")

## Proceed if 200
if [[ "200" = $response_header ]]; then
	echo "The production repo is OPEN."
	echo "Proceeding with commit."
	exit 0
## Bail if 4oo (or anything else)
else
	full_response=$(curl --silent "$endpoint_url")
	echo "==========================================================="
	echo "$full_response"
	echo "==========================================================="
	exit 1
fi